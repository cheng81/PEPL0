namespace org.pepl.sample.arrangemeeting

process Main {
	create<Case> {
		new Arrange(Case)
		new Arrange(Case).Proposal(0)
	}

	process Arrange(Case) {

		must proposeLo<date> {
			response auto Proposal(*).update<date>
			include acceptDa
			response acceptDa
		}
		proposeDa<date> {
			when Condition(proposeLo<*>) {
				response auto Proposal(*).update<date>
				include acceptLo
				response acceptLo
			}
		}

		excluded acceptLo {
			let p := Proposal(*)
			debug('Lo accepted, at date',p.state.store.Date)
			exclude acceptLo
			exclude acceptDa
		}
		excluded acceptDa {
			let p := Proposal(*)
			debug('Da accepted, at date',p.state.store.Date)
			exclude acceptDa
			exclude acceptLo
		}

		process Proposal(Date) {
			update<newDate> {
				exclude super
				new Proposal(newDate)
			}
		}
	}
	holdMeeting<Case> {
		when Accepting(Arrange(Case)) {
			let c := Arrange(Case)
			let p := c:Proposal(*)
			debug('Meeting',Case,'held at date',p.state.store.Date)
		}
	}

}