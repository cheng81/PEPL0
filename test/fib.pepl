namespace org.pepl.sample.fib

process Main {
	fib<n> {
		when Condition(result<n,?res>) {
			response auto result<n,?res>
		} else {
			new Fib(n)
			response auto Fib(n).step
		}
	}

	result<n,result>
	{
		debug(n,'th fibonacci number is ',result)
	}

	process Fib(n) {
		step {
			when Condition(result<(- n 1),?r1>), Condition(result<(- n 2),?r2>) {
				response auto result<n,(+ ?r1 ?r2)>
				response auto Fib((+ n 1)).step
				exclude super
			} else {
				new Fib((- n 1))
				response auto Fib((- n 1)).step
			}
		}
	}
}
